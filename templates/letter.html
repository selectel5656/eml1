{% extends 'base.html' %}
{% block title %}Письмо{% endblock %}
{% block content %}
<h2>Письмо</h2>
<form method="post">
  <div class="mb-3">
    <label class="form-label">Тема</label>
    <input class="form-control" name="subject">
  </div>
  <div class="mb-3">
    <label class="form-label">Текст</label>
    <textarea class="form-control" name="body" rows="6"></textarea>
  </div>
  <div class="mb-3">
    <label class="form-label">Аттачи</label><br>
    {% for a in attachments %}
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="attachments" value="{{ a.id }}" id="att{{a.id}}">
        <label class="form-check-label" for="att{{a.id}}">{{ a.display_name }} ({{ a.send_filename or a.filename }})
          {% if a.macro_base64 %} макрос: {{'{{$'+a.macro_base64+'}}'}}{% endif %}
          {% if a.macro_url %} url: {{'{{$'+a.macro_url+'}}'}}{% endif %}
          {% if a.macro_id %} id: {{'{{$'+a.macro_id+'}}'}}{% endif %}
          {% if a.inline and a.macro_base64 %}
            {% set ext = a.filename.split('.')[-1].lower() %}
            <br><small>пример: &lt;img src="data:image/{{ext}};base64,{{'{{$'+a.macro_base64+'}}'}}"></small>
          {% endif %}
        </label>
      </div><br>
    {% endfor %}
  </div>
  <button class="btn btn-primary" name="action" value="start">Старт</button>
  <button class="btn btn-danger" name="action" value="stop">Стоп</button>
  <a class="btn btn-secondary" href="{{ url_for('reset_counts') }}">Скинуть счетчики отправок</a>
</form>
{% endblock %}
